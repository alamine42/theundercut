# render.yaml
services:
  # 1️⃣ Web (FastAPI)
  - type: web
    name: theundercut-web
    env: docker
    repo: https://github.com/alamine42/theundercut
    plan: free
    dockerCommand: uvicorn theundercut.api.main:app --host 0.0.0.0 --port $PORT

    # --- declare common blocks &default_envvars / &default_disks ------------
    envVars: &default_envvars
      - key: DATABASE_URL
        fromDatabase:
          name: theundercut-db
          property: connectionString
      - key: REDIS_URL
        fromService:
          name: theundercut-cache
          property: connectionString
      - key: SECRET_KEY
        generateValue: true

    disks: &default_disks
      - name: data
        mountPath: /data
        sizeGB: 1
    # ------------------------------------------------------------------------

  # 2️⃣ Background worker (placeholder until we add RQ code)
  - type: worker
    name: theundercut-worker
    env: docker
    repo: https://github.com/alamine42/theundercut
    plan: free
    dockerCommand: python -c "print('worker placeholder')"

    envVars: *default_envvars   # ← reference the anchor
    disks:   *default_disks     # ← reference the anchor

databases:
  - name: theundercut-db
    plan: free
    databaseName: theundercut
    user: theundercut

redis:
  - name: theundercut-cache
    plan: free
